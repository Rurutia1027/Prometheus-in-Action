## Functions in PromQL

PromQL has several different function for a variety of use cases including **sorting**, **math**, **label transformation**, **metric manipulation** and many more.  


## Recording Rules Supported by Prometheus 
Recording Rules allow Prometheus to periodically **evaluate** PromQL expression and **store** the resulting times series generated by them. 
This can speed up our Grafana's dashboards loading time, and provide aggregated results for the elsewhere. 

- How to define recording rule in `prometheus.yml` ? 

```yml 
global:
  scrape_intervals: 5s
  evaluation_interval: 5s
rule_files:
  - rules.yml 
scrape_configs:
  - job_name: prometheus 
    static_configs: 
      - targets:
        - localhost:9090 
```

Changes in rule files is not automatically detected and loaded by Prometheus, so restarting Prometheus is required. 

- rule.yml 
```yml 
groups:
  - name: <group name 1>
    interval: <evaluation interval>
    rules:
      - record: <rule name 1>
        expr: <promql expression 1>
        labels: 
          <label name>:<label value>
      - record: <rule name 2>
        expr: <promql expression 2>
        labels: 
  - name: <group name 2>
    rules: 
```

## HTTP API 
Prometheus has an **HTTP API** that can be used to execute queries as well as gather information on alert, rules, and service-discovery related configs. 

This is useful for situations where using the built-in web gui isn't an option. 

- To run a query through the API send a **POST** request to:
`http://<prometheus-ip>/api/v1/query`

The query is then passed into the query parameter. 

`node_arp_entries{instance="192.168.1.168:9100"}`

This query can be converted into the http query like: 

```shell 
curl <prometheus>:9090/api/v1/query \
--data 'query=node_arp_entries{instance="192.168.1.168:9100"}'
```

- Prometheus API even support execute the query at specific timestamp, query like this: 
```shell 
curl localhost:9090/api/v1/query --data \
 'query=node_arp_entries{instance="192.168.1.168:9100"}' --data 'time=1670380860.132'
```

- Prometheus API also support query data in vector, query like this: 

```shell 
curl localhost:9090/api/v1/query --data \
 'query=node_arp_entries{instance="192.168.1.168:9100"}[5m]' --data 'time=1670380860.132'
```